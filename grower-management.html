<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pioneer Grower Management</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        /* LOGIN SCREEN */
        .login-screen {
            min-height: 100vh;
            background: linear-gradient(135deg, #1a5d1a 0%, #2e7d32 50%, #1b5e20 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-card {
            background: white;
            padding: 50px 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ffc107, #ff9800);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .login-title {
            color: #1a5d1a;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .login-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .login-input::placeholder {
            color: #999;
        }

        .login-input:focus {
            outline: none;
            border-color: #1a5d1a;
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #1a5d1a, #2e7d32);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(26,93,26,0.4);
        }

        .login-error {
            color: #d32f2f;
            margin-top: 15px;
            display: none;
        }

        /* MAIN APP */
        .app-container {
            display: none;
        }

        /* TOP NAV */
        .top-nav {
            background: linear-gradient(135deg, #1a5d1a, #2e7d32);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ffc107, #ff9800);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .nav-title {
            font-size: 22px;
            font-weight: 700;
        }

        .nav-links {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 500;
            text-decoration: none;
            color: white;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.15);
        }

        .nav-link.active {
            background: rgba(255,255,255,0.25);
        }

        .logout-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.25);
        }

        /* DASHBOARD */
        .dashboard {
            padding: 30px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 28px;
            color: #1a5d1a;
            font-weight: 700;
        }

        .dashboard-subtitle {
            color: #666;
            margin-top: 5px;
        }

        /* STATS CARDS */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #1a5d1a;
        }

        .stat-change {
            font-size: 13px;
            margin-top: 8px;
        }

        .stat-change.positive {
            color: #2e7d32;
        }

        .stat-change.negative {
            color: #d32f2f;
        }

        /* SEARCH & FILTERS */
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 14px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
        }

        .search-input:focus {
            outline: none;
            border-color: #1a5d1a;
        }

        .filter-select {
            padding: 14px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            background: white;
            cursor: pointer;
        }

        /* GROWER CARDS */
        .grower-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
        }

        .grower-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .grower-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .grower-header {
            background: linear-gradient(135deg, #1a5d1a, #2e7d32);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grower-name {
            font-size: 20px;
            font-weight: 700;
        }

        .grower-priority {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high {
            background: #ffeb3b;
            color: #333;
        }

        .priority-medium {
            background: rgba(255,255,255,0.25);
            color: white;
        }

        .priority-low {
            background: rgba(255,255,255,0.15);
            color: rgba(255,255,255,0.8);
        }

        .grower-body {
            padding: 20px;
        }

        .grower-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .grower-stat {
            text-align: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .grower-stat-value {
            font-size: 22px;
            font-weight: 700;
            color: #1a5d1a;
        }

        .grower-stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            font-weight: 600;
        }

        .trend-up {
            color: #2e7d32;
        }

        .trend-down {
            color: #d32f2f;
        }

        .trend-stable {
            color: #666;
        }

        /* AI RECOMMENDATION */
        .ai-recommendation {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a5d1a;
        }

        .ai-icon {
            width: 20px;
            height: 20px;
            background: #1a5d1a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .ai-text {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }

        /* VARIETY TAGS */
        .variety-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .variety-tag {
            padding: 4px 10px;
            background: #e3f2fd;
            color: #1565c0;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        /* ACTION BUTTONS */
        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: background 0.2s;
        }

        .action-btn.primary {
            background: #1a5d1a;
            color: white;
        }

        .action-btn.primary:hover {
            background: #145214;
        }

        .action-btn.secondary {
            background: #f5f5f5;
            color: #333;
        }

        .action-btn.secondary:hover {
            background: #e0e0e0;
        }

        /* CALENDAR VIEW */
        .calendar-section {
            display: none;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .calendar-nav-btn {
            padding: 10px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .calendar-nav-btn:hover {
            background: #f5f5f5;
        }

        .calendar-month {
            font-size: 24px;
            font-weight: 700;
            color: #1a5d1a;
        }

        .calendar-actions {
            display: flex;
            gap: 10px;
        }

        .export-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #1a5d1a, #2e7d32);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            opacity: 0.9;
        }

        .calendar-grid {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .weekday {
            padding: 15px;
            text-align: center;
            font-weight: 600;
            color: #666;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            min-height: 120px;
            padding: 10px;
            border-right: 1px solid #f0f0f0;
            border-bottom: 1px solid #f0f0f0;
        }

        .calendar-day:nth-child(7n) {
            border-right: none;
        }

        .calendar-day.other-month {
            background: #fafafa;
        }

        .calendar-day.today {
            background: #e8f5e9;
        }

        .day-number {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .day-number.other {
            color: #bbb;
        }

        .calendar-event {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-bottom: 4px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .event-call {
            background: #e3f2fd;
            color: #1565c0;
        }

        .event-visit {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .event-followup {
            background: #fff3e0;
            color: #e65100;
        }

        .event-fieldday {
            background: #fce4ec;
            color: #c2185b;
            font-weight: 600;
        }

        .event-fieldsigns {
            background: #f3e5f5;
            color: #7b1fa2;
            font-weight: 600;
        }

        /* SCHEDULE LIST */
        .schedule-list {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            margin-top: 25px;
        }

        .schedule-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            font-size: 18px;
            font-weight: 700;
            color: #1a5d1a;
        }

        .schedule-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #f5f5f5;
            gap: 15px;
        }

        .schedule-item:last-child {
            border-bottom: none;
        }

        .schedule-date {
            text-align: center;
            min-width: 60px;
        }

        .schedule-day {
            font-size: 24px;
            font-weight: 700;
            color: #1a5d1a;
        }

        .schedule-month {
            font-size: 12px;
            color: #666;
        }

        .schedule-details {
            flex: 1;
        }

        .schedule-title {
            font-weight: 600;
            color: #333;
        }

        .schedule-grower {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }

        .schedule-type {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .type-call {
            background: #e3f2fd;
            color: #1565c0;
        }

        .type-visit {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .type-followup {
            background: #fff3e0;
            color: #e65100;
        }

        .type-fieldday {
            background: #fce4ec;
            color: #c2185b;
        }

        .type-fieldsigns {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(135deg, #1a5d1a, #2e7d32);
            color: white;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 25px;
        }

        .detail-section {
            margin-bottom: 25px;
        }

        .detail-title {
            font-size: 16px;
            font-weight: 700;
            color: #1a5d1a;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8f5e9;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .detail-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .detail-value {
            font-size: 24px;
            font-weight: 700;
            color: #1a5d1a;
        }

        .detail-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .history-chart {
            height: 200px;
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #1a5d1a;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1a5d1a, #2e7d32);
            color: white;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .top-nav {
                flex-direction: column;
                gap: 15px;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .grower-grid {
                grid-template-columns: 1fr;
            }

            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .detail-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .calendar-day {
                min-height: 80px;
                padding: 5px;
            }

            .calendar-event {
                font-size: 9px;
                padding: 2px 4px;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">&#127793;</div>
            <h1 class="login-title">Pioneer Grower Management</h1>
            <p class="login-subtitle">Sign in to access your dashboard</p>
            <form id="loginForm">
                <input type="email" class="login-input" id="loginEmail" placeholder="Email Address" autocomplete="email">
                <input type="password" class="login-input" id="loginPassword" placeholder="Password" autocomplete="current-password">
                <button type="submit" class="login-btn">Sign In</button>
            </form>
            <p class="login-error" id="loginError">Invalid access code. Please try again.</p>
        </div>
    </div>

    <!-- MAIN APP -->
    <div class="app-container" id="appContainer">
        <!-- TOP NAV -->
        <nav class="top-nav">
            <div class="nav-brand">
                <div class="nav-logo">&#127793;</div>
                <span class="nav-title">Grower Management</span>
            </div>
            <div class="nav-links">
                <a href="index-new.html" class="nav-link">Home</a>
                <div class="nav-link active" data-view="customers">Customers</div>
                <div class="nav-link" data-view="calendar">Calendar</div>
            </div>
            <button class="logout-btn" id="logoutBtn">Sign Out</button>
        </nav>

        <!-- DASHBOARD VIEW -->
        <div class="dashboard" id="dashboardView">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Grower Overview</h1>
                <p class="dashboard-subtitle">Manage your customer relationships and track performance</p>
            </div>

            <!-- STATS -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-label">Total Growers</div>
                    <div class="stat-value" id="totalGrowers">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Bags (2026)</div>
                    <div class="stat-value" id="totalBags">0</div>
                    <div class="stat-change positive" id="bagsChange">+0% from 2025</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Revenue (2026)</div>
                    <div class="stat-value" id="totalRevenue">$0</div>
                    <div class="stat-change positive" id="revenueChange">+0% from 2025</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Discount</div>
                    <div class="stat-value" id="avgDiscount">8%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Scheduled Calls</div>
                    <div class="stat-value" id="scheduledCalls">0</div>
                </div>
            </div>

            <!-- SEARCH -->
            <div class="search-bar">
                <input type="text" class="search-input" id="searchInput" placeholder="Search growers...">
                <select class="filter-select" id="priorityFilter">
                    <option value="all">All Priorities</option>
                    <option value="high">High Priority</option>
                    <option value="medium">Medium Priority</option>
                    <option value="low">Low Priority</option>
                </select>
                <select class="filter-select" id="sortBy">
                    <option value="name">Sort by Name</option>
                    <option value="spend">Sort by Spend</option>
                    <option value="bags">Sort by Bags</option>
                    <option value="trend">Sort by Trend</option>
                </select>
            </div>

            <!-- GROWER CARDS -->
            <div class="grower-grid" id="growerGrid">
                <!-- Cards populated by JS -->
            </div>
        </div>

        <!-- CALENDAR VIEW -->
        <div class="calendar-section" id="calendarView">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Schedule & Calendar</h1>
                <p class="dashboard-subtitle">Plan and track your grower interactions</p>
            </div>

            <div class="calendar-header">
                <div class="calendar-nav">
                    <button class="calendar-nav-btn" id="prevMonth">&larr;</button>
                    <span class="calendar-month" id="calendarMonth">February 2026</span>
                    <button class="calendar-nav-btn" id="nextMonth">&rarr;</button>
                </div>
                <div class="calendar-actions">
                    <button class="export-btn" id="addEventBtn">+ Add Event</button>
                    <button class="export-btn" id="exportIcal">&#128197; Export to Apple Calendar</button>
                </div>
            </div>

            <div class="calendar-grid">
                <div class="calendar-weekdays">
                    <div class="weekday">Sun</div>
                    <div class="weekday">Mon</div>
                    <div class="weekday">Tue</div>
                    <div class="weekday">Wed</div>
                    <div class="weekday">Thu</div>
                    <div class="weekday">Fri</div>
                    <div class="weekday">Sat</div>
                </div>
                <div class="calendar-days" id="calendarDays">
                    <!-- Days populated by JS -->
                </div>
            </div>

            <div class="schedule-list">
                <div class="schedule-header">Upcoming Schedule</div>
                <div id="scheduleList">
                    <!-- Schedule items populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- GROWER DETAIL MODAL -->
    <div class="modal-overlay" id="growerModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modalGrowerName">Grower Name</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-section">
                    <h3 class="detail-title">3-Year Performance</h3>
                    <div class="detail-grid" id="modalStats">
                        <!-- Stats populated by JS -->
                    </div>
                    <canvas id="growerChart" class="history-chart"></canvas>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">AI Engagement Plan</h3>
                    <div class="ai-recommendation" id="modalAiPlan">
                        <!-- AI plan populated by JS -->
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">Varieties Purchased</h3>
                    <div class="variety-tags" id="modalVarieties">
                        <!-- Varieties populated by JS -->
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-primary" id="scheduleCallBtn">&#128222; Schedule Call</button>
                    <button class="btn btn-secondary" id="scheduleVisitBtn">&#128205; Schedule Visit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ADD EVENT MODAL -->
    <div class="modal-overlay" id="eventModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Schedule Event</h2>
                <button class="modal-close" id="closeEventModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Grower</label>
                    <select class="form-select" id="eventGrower">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Event Type</label>
                    <select class="form-select" id="eventType">
                        <option value="call">Phone Call</option>
                        <option value="visit">Farm Visit</option>
                        <option value="followup">Follow-up</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" id="eventDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Time</label>
                    <input type="time" class="form-input" id="eventTime" value="09:00">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="eventNotes" placeholder="Add notes about this interaction..."></textarea>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-primary" id="saveEventBtn">Save Event</button>
                    <button class="btn btn-secondary" id="cancelEventBtn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Constants
        const PRICE_PER_BAG = 280;
        const AUTH_EMAIL = 'kyle@togoag.com';
        const AUTH_PASSWORD = 'Pioneer2026';

        // State
        let growerData = {};
        let calendarEvents = JSON.parse(localStorage.getItem('growerEvents') || '[]');
        let currentMonth = new Date();
        let growerChart = null;

        // Get 3rd Thursday of a given month/year
        function getNthWeekday(year, month, weekday, n) {
            const firstDay = new Date(year, month, 1);
            let dayOfWeek = firstDay.getDay();
            let daysUntilWeekday = (weekday - dayOfWeek + 7) % 7;
            let nthDate = 1 + daysUntilWeekday + (n - 1) * 7;
            return new Date(year, month, nthDate);
        }

        // Generate annual events for current and next year
        function getAnnualEvents() {
            const events = [];
            const currentYear = new Date().getFullYear();

            [currentYear, currentYear + 1].forEach(year => {
                // Field Days - 3rd Thursday in August (month 7)
                const fieldDaysDate = getNthWeekday(year, 7, 4, 3); // 4 = Thursday
                events.push({
                    grower: 'ALL GROWERS',
                    type: 'fieldday',
                    date: fieldDaysDate.toISOString().split('T')[0],
                    time: '08:00',
                    notes: 'Annual Field Day Event',
                    isAnnual: true
                });

                // Field Signs - June 1st (beginning of June)
                events.push({
                    grower: 'ALL GROWERS',
                    type: 'fieldsigns',
                    date: `${year}-06-01`,
                    time: '08:00',
                    notes: 'Put up field signs',
                    isAnnual: true
                });
            });

            return events;
        }

        // Fetch grower data
        async function loadGrowerData() {
            try {
                const response = await fetch('data/grower_data.json');
                growerData = await response.json();
                processGrowerData();
            } catch (error) {
                console.error('Error loading grower data:', error);
            }
        }

        // Process data into grower profiles
        function processGrowerData() {
            const growers = {};

            ['2024', '2025', '2026'].forEach(year => {
                if (growerData[year] && growerData[year].corn) {
                    growerData[year].corn.forEach(item => {
                        if (!growers[item.grower]) {
                            growers[item.grower] = {
                                name: item.grower,
                                years: { 2024: { bags: 0, varieties: [], spend: 0 },
                                         2025: { bags: 0, varieties: [], spend: 0 },
                                         2026: { bags: 0, varieties: [], spend: 0 } }
                            };
                        }
                        const g = growers[item.grower];
                        g.years[year].bags += item.bags;
                        g.years[year].spend += item.bags * PRICE_PER_BAG;
                        if (!g.years[year].varieties.includes(item.hybrid)) {
                            g.years[year].varieties.push(item.hybrid);
                        }
                    });
                }
            });

            // Calculate trends and priorities
            Object.values(growers).forEach(g => {
                const bags24 = g.years['2024'].bags;
                const bags25 = g.years['2025'].bags;
                const bags26 = g.years['2026'].bags;

                g.totalBags = bags24 + bags25 + bags26;
                g.totalSpend = g.years['2024'].spend + g.years['2025'].spend + g.years['2026'].spend;
                g.avgDiscount = Math.round(5 + (g.totalBags / 50)); // Simulated discount based on volume
                if (g.avgDiscount > 15) g.avgDiscount = 15;

                // Calculate trend
                if (bags26 > bags25 * 1.1) {
                    g.trend = 'up';
                    g.trendPct = Math.round(((bags26 - bags25) / bags25) * 100);
                } else if (bags26 < bags25 * 0.9) {
                    g.trend = 'down';
                    g.trendPct = Math.round(((bags25 - bags26) / bags25) * 100);
                } else {
                    g.trend = 'stable';
                    g.trendPct = 0;
                }

                // Determine priority based on AI analysis
                g.priority = calculatePriority(g);
                g.aiPlan = generateAIPlan(g);

                // All varieties
                const allVarieties = new Set();
                Object.values(g.years).forEach(y => y.varieties.forEach(v => allVarieties.add(v)));
                g.allVarieties = Array.from(allVarieties);
            });

            window.growerProfiles = Object.values(growers).sort((a, b) => a.name.localeCompare(b.name));

            renderDashboard();
            populateEventGrowerSelect();
        }

        // Calculate priority
        function calculatePriority(g) {
            const bags26 = g.years['2026'].bags;
            const bags25 = g.years['2025'].bags;

            // High priority: declining customers with good history OR high volume
            if (g.trend === 'down' && bags25 > 30) return 'high';
            if (bags26 > 60) return 'high';

            // Medium priority: stable good customers
            if (bags26 > 30 || g.trend === 'up') return 'medium';

            // Low priority: small or stable small customers
            return 'low';
        }

        // Generate AI plan
        function generateAIPlan(g) {
            const bags26 = g.years['2026'].bags;
            const bags25 = g.years['2025'].bags;
            const avgVarieties = (g.years['2024'].varieties.length + g.years['2025'].varieties.length + g.years['2026'].varieties.length) / 3;

            let plan = {
                action: '',
                reason: '',
                schedule: '',
                focus: ''
            };

            if (g.trend === 'down' && bags25 > 30) {
                plan.action = 'INCREASE TIME';
                plan.reason = `Volume dropped ${g.trendPct}% year-over-year. This is a key account that needs attention.`;
                plan.schedule = 'Schedule bi-weekly calls and monthly farm visits';
                plan.focus = 'Discuss pricing, explore reasons for decline, present 2027 new hybrids';
            } else if (g.trend === 'up' && bags26 > 40) {
                plan.action = 'MAINTAIN RELATIONSHIP';
                plan.reason = `Strong growth of ${g.trendPct}%. This is a growing account worth nurturing.`;
                plan.schedule = 'Monthly check-ins with quarterly visits';
                plan.focus = 'Thank for loyalty, discuss expansion opportunities, offer volume discounts';
            } else if (bags26 > 60) {
                plan.action = 'VIP TREATMENT';
                plan.reason = `High volume customer (${bags26} bags). Key account for your business.`;
                plan.schedule = 'Weekly touch points, bi-monthly visits';
                plan.focus = 'Relationship building, early access to new products, premium support';
            } else if (bags26 < 20 && avgVarieties < 2) {
                plan.action = 'REDUCE TIME';
                plan.reason = `Small account with limited variety adoption (${avgVarieties.toFixed(1)} avg varieties).`;
                plan.schedule = 'Quarterly calls only';
                plan.focus = 'Maintain relationship but focus time on higher-value accounts';
            } else {
                plan.action = 'STANDARD ENGAGEMENT';
                plan.reason = 'Stable mid-tier account with consistent purchasing.';
                plan.schedule = 'Monthly calls with seasonal visits';
                plan.focus = 'Product education, cross-selling opportunities';
            }

            return plan;
        }

        // Render dashboard
        function renderDashboard() {
            const growers = window.growerProfiles || [];

            // Stats
            const total2026Bags = growers.reduce((sum, g) => sum + g.years['2026'].bags, 0);
            const total2025Bags = growers.reduce((sum, g) => sum + g.years['2025'].bags, 0);
            const bagsChange = total2025Bags > 0 ? Math.round(((total2026Bags - total2025Bags) / total2025Bags) * 100) : 0;

            document.getElementById('totalGrowers').textContent = growers.length;
            document.getElementById('totalBags').textContent = total2026Bags.toLocaleString();
            document.getElementById('totalRevenue').textContent = '$' + (total2026Bags * PRICE_PER_BAG).toLocaleString();

            const bagsChangeEl = document.getElementById('bagsChange');
            bagsChangeEl.textContent = (bagsChange >= 0 ? '+' : '') + bagsChange + '% from 2025';
            bagsChangeEl.className = 'stat-change ' + (bagsChange >= 0 ? 'positive' : 'negative');

            const revenueChangeEl = document.getElementById('revenueChange');
            revenueChangeEl.textContent = (bagsChange >= 0 ? '+' : '') + bagsChange + '% from 2025';
            revenueChangeEl.className = 'stat-change ' + (bagsChange >= 0 ? 'positive' : 'negative');

            document.getElementById('scheduledCalls').textContent = calendarEvents.length;

            renderGrowerCards(growers);
        }

        // Render grower cards
        function renderGrowerCards(growers) {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const priorityFilter = document.getElementById('priorityFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            // Filter
            let filtered = growers.filter(g => {
                const matchesSearch = g.name.toLowerCase().includes(searchTerm);
                const matchesPriority = priorityFilter === 'all' || g.priority === priorityFilter;
                return matchesSearch && matchesPriority;
            });

            // Sort
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'spend': return b.totalSpend - a.totalSpend;
                    case 'bags': return b.totalBags - a.totalBags;
                    case 'trend': return (b.trend === 'up' ? 1 : b.trend === 'down' ? -1 : 0) -
                                         (a.trend === 'up' ? 1 : a.trend === 'down' ? -1 : 0);
                    default: return a.name.localeCompare(b.name);
                }
            });

            const grid = document.getElementById('growerGrid');
            grid.innerHTML = filtered.map(g => `
                <div class="grower-card" data-grower="${g.name}">
                    <div class="grower-header">
                        <span class="grower-name">${g.name}</span>
                        <span class="grower-priority priority-${g.priority}">${g.priority}</span>
                    </div>
                    <div class="grower-body">
                        <div class="grower-stats">
                            <div class="grower-stat">
                                <div class="grower-stat-value">${g.years['2026'].bags}</div>
                                <div class="grower-stat-label">2026 Bags</div>
                            </div>
                            <div class="grower-stat">
                                <div class="grower-stat-value">$${g.years['2026'].spend.toLocaleString()}</div>
                                <div class="grower-stat-label">2026 Spend</div>
                            </div>
                            <div class="grower-stat">
                                <div class="grower-stat-value">${g.avgDiscount}%</div>
                                <div class="grower-stat-label">Discount</div>
                            </div>
                            <div class="grower-stat">
                                <div class="grower-stat-value">
                                    <span class="trend-indicator trend-${g.trend}">
                                        ${g.trend === 'up' ? '&#9650;' : g.trend === 'down' ? '&#9660;' : '&#9654;'}
                                        ${g.trendPct > 0 ? g.trendPct + '%' : 'Stable'}
                                    </span>
                                </div>
                                <div class="grower-stat-label">Trend</div>
                            </div>
                        </div>

                        <div class="ai-recommendation">
                            <div class="ai-header">
                                <span class="ai-icon">AI</span>
                                ${g.aiPlan.action}
                            </div>
                            <div class="ai-text">${g.aiPlan.reason}</div>
                        </div>

                        <div class="variety-tags">
                            ${g.years['2026'].varieties.map(v => `<span class="variety-tag">${v}</span>`).join('')}
                        </div>

                        <div class="card-actions">
                            <button class="action-btn primary call-btn" data-grower="${g.name}">&#128222; Call</button>
                            <button class="action-btn secondary view-btn" data-grower="${g.name}">View Details</button>
                        </div>
                    </div>
                </div>
            `).join('');

            // Add event listeners
            document.querySelectorAll('.grower-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('call-btn')) {
                        openGrowerModal(card.dataset.grower);
                    }
                });
            });

            document.querySelectorAll('.call-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    scheduleCall(btn.dataset.grower);
                });
            });
        }

        // Open grower modal
        function openGrowerModal(growerName) {
            const g = window.growerProfiles.find(p => p.name === growerName);
            if (!g) return;

            document.getElementById('modalGrowerName').textContent = g.name;

            // Stats
            document.getElementById('modalStats').innerHTML = `
                <div class="detail-item">
                    <div class="detail-value">${g.totalBags}</div>
                    <div class="detail-label">Total Bags (3yr)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-value">$${g.totalSpend.toLocaleString()}</div>
                    <div class="detail-label">Total Spend (3yr)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-value">${g.avgDiscount}%</div>
                    <div class="detail-label">Avg Discount</div>
                </div>
            `;

            // AI Plan
            document.getElementById('modalAiPlan').innerHTML = `
                <div class="ai-header">
                    <span class="ai-icon">AI</span>
                    Recommendation: ${g.aiPlan.action}
                </div>
                <div class="ai-text">
                    <p><strong>Why:</strong> ${g.aiPlan.reason}</p>
                    <p><strong>Schedule:</strong> ${g.aiPlan.schedule}</p>
                    <p><strong>Focus on:</strong> ${g.aiPlan.focus}</p>
                </div>
            `;

            // Varieties
            document.getElementById('modalVarieties').innerHTML = g.allVarieties
                .map(v => `<span class="variety-tag">${v}</span>`).join('');

            // Chart
            renderGrowerChart(g);

            // Store current grower for scheduling
            window.currentModalGrower = g.name;

            document.getElementById('growerModal').classList.add('show');
        }

        // Render grower chart
        function renderGrowerChart(g) {
            const ctx = document.getElementById('growerChart').getContext('2d');

            if (growerChart) {
                growerChart.destroy();
            }

            growerChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2024', '2025', '2026'],
                    datasets: [{
                        label: 'Bags',
                        data: [g.years['2024'].bags, g.years['2025'].bags, g.years['2026'].bags],
                        backgroundColor: ['#81c784', '#4caf50', '#2e7d32'],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Schedule call
        function scheduleCall(growerName) {
            document.getElementById('eventGrower').value = growerName;
            document.getElementById('eventType').value = 'call';
            document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('eventModal').classList.add('show');
        }

        // Get all events (user + annual)
        function getAllEvents() {
            return [...calendarEvents, ...getAnnualEvents()];
        }

        // Calendar functions
        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();

            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

            const allEvents = getAllEvents();

            let html = '';
            let day = 1;
            let nextMonthDay = 1;

            for (let i = 0; i < 42; i++) {
                let dayNum, isOtherMonth = false, isToday = false;

                if (i < firstDay) {
                    dayNum = daysInPrevMonth - firstDay + i + 1;
                    isOtherMonth = true;
                } else if (day > daysInMonth) {
                    dayNum = nextMonthDay++;
                    isOtherMonth = true;
                } else {
                    dayNum = day++;
                    if (isCurrentMonth && dayNum === today.getDate()) {
                        isToday = true;
                    }
                }

                const dateStr = isOtherMonth ? '' : `${year}-${String(month + 1).padStart(2, '0')}-${String(dayNum).padStart(2, '0')}`;
                const dayEvents = isOtherMonth ? [] : allEvents.filter(e => e.date === dateStr);

                html += `
                    <div class="calendar-day ${isOtherMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}">
                        <div class="day-number ${isOtherMonth ? 'other' : ''}">${dayNum}</div>
                        ${dayEvents.map(e => `
                            <div class="calendar-event event-${e.type}" title="${e.grower}: ${e.notes || e.type}">
                                ${e.type === 'fieldday' ? 'FIELD DAY' : e.type === 'fieldsigns' ? 'FIELD SIGNS' : e.grower}
                            </div>
                        `).join('')}
                    </div>
                `;

                if (day > daysInMonth && i >= 34) break;
            }

            document.getElementById('calendarDays').innerHTML = html;
            renderScheduleList();
        }

        // Get event title based on type
        function getEventTitle(type) {
            switch(type) {
                case 'call': return 'Phone Call';
                case 'visit': return 'Farm Visit';
                case 'followup': return 'Follow-up';
                case 'fieldday': return 'Field Day';
                case 'fieldsigns': return 'Field Signs Setup';
                default: return type;
            }
        }

        // Render schedule list
        function renderScheduleList() {
            const allEvents = getAllEvents();
            const upcoming = allEvents
                .filter(e => new Date(e.date) >= new Date())
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(0, 10);

            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                               'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            document.getElementById('scheduleList').innerHTML = upcoming.length === 0
                ? '<div class="schedule-item"><div class="schedule-details">No upcoming events. Add some from the grower cards!</div></div>'
                : upcoming.map(e => {
                    const date = new Date(e.date);
                    return `
                        <div class="schedule-item">
                            <div class="schedule-date">
                                <div class="schedule-day">${date.getDate()}</div>
                                <div class="schedule-month">${monthNames[date.getMonth()]}</div>
                            </div>
                            <div class="schedule-details">
                                <div class="schedule-title">${getEventTitle(e.type)}</div>
                                <div class="schedule-grower">${e.grower}${e.notes ? ' - ' + e.notes : ''}</div>
                            </div>
                            <span class="schedule-type type-${e.type}">${e.type === 'fieldday' ? 'field day' : e.type === 'fieldsigns' ? 'signs' : e.type}</span>
                        </div>
                    `;
                }).join('');
        }

        // Export to iCal
        function exportToICal() {
            let ical = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Pioneer Grower Management//EN\n';

            const allEvents = getAllEvents();
            allEvents.forEach((e, i) => {
                const date = e.date.replace(/-/g, '');
                const time = (e.time || '09:00').replace(':', '') + '00';
                const summary = e.type === 'fieldday' ? 'PIONEER FIELD DAY' :
                               e.type === 'fieldsigns' ? 'Put Up Field Signs' :
                               `${getEventTitle(e.type)}: ${e.grower}`;
                ical += `BEGIN:VEVENT
UID:pioneer-${i}-${Date.now()}@grower-management
DTSTART:${date}T${time}
DTEND:${date}T${time}
SUMMARY:${summary}
DESCRIPTION:${e.notes || 'Pioneer event'}
END:VEVENT\n`;
            });

            ical += 'END:VCALENDAR';

            const blob = new Blob([ical], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pioneer-grower-schedule.ics';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Populate event grower select
        function populateEventGrowerSelect() {
            const select = document.getElementById('eventGrower');
            const growers = window.growerProfiles || [];
            select.innerHTML = growers.map(g => `<option value="${g.name}">${g.name}</option>`).join('');
        }

        // Save event
        function saveEvent() {
            const event = {
                grower: document.getElementById('eventGrower').value,
                type: document.getElementById('eventType').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                notes: document.getElementById('eventNotes').value
            };

            if (!event.date) {
                alert('Please select a date');
                return;
            }

            calendarEvents.push(event);
            localStorage.setItem('growerEvents', JSON.stringify(calendarEvents));

            document.getElementById('eventModal').classList.remove('show');
            document.getElementById('eventNotes').value = '';

            renderCalendar();
            document.getElementById('scheduledCalls').textContent = calendarEvents.length;
        }

        // Event listeners
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            if (email === AUTH_EMAIL && password === AUTH_PASSWORD) {
                sessionStorage.setItem('pioneer_auth', 'true');
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                loadGrowerData();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            sessionStorage.removeItem('pioneer_auth');
            location.reload();
        });

        document.querySelectorAll('.nav-link[data-view]').forEach(link => {
            link.addEventListener('click', () => {
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                const view = link.dataset.view;
                document.getElementById('dashboardView').style.display = view === 'customers' ? 'block' : 'none';
                document.getElementById('calendarView').style.display = view === 'calendar' ? 'block' : 'none';

                if (view === 'calendar') {
                    renderCalendar();
                }
            });
        });

        document.getElementById('searchInput').addEventListener('input', () => renderGrowerCards(window.growerProfiles));
        document.getElementById('priorityFilter').addEventListener('change', () => renderGrowerCards(window.growerProfiles));
        document.getElementById('sortBy').addEventListener('change', () => renderGrowerCards(window.growerProfiles));

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('growerModal').classList.remove('show');
        });

        document.getElementById('closeEventModal').addEventListener('click', () => {
            document.getElementById('eventModal').classList.remove('show');
        });

        document.getElementById('cancelEventBtn').addEventListener('click', () => {
            document.getElementById('eventModal').classList.remove('show');
        });

        document.getElementById('addEventBtn').addEventListener('click', () => {
            document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('eventModal').classList.add('show');
        });

        document.getElementById('saveEventBtn').addEventListener('click', saveEvent);
        document.getElementById('exportIcal').addEventListener('click', exportToICal);

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        });

        document.getElementById('scheduleCallBtn').addEventListener('click', () => {
            document.getElementById('growerModal').classList.remove('show');
            scheduleCall(window.currentModalGrower);
        });

        document.getElementById('scheduleVisitBtn').addEventListener('click', () => {
            document.getElementById('growerModal').classList.remove('show');
            document.getElementById('eventGrower').value = window.currentModalGrower;
            document.getElementById('eventType').value = 'visit';
            document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('eventModal').classList.add('show');
        });

        // Close modals on outside click
        document.getElementById('growerModal').addEventListener('click', (e) => {
            if (e.target.id === 'growerModal') {
                document.getElementById('growerModal').classList.remove('show');
            }
        });

        document.getElementById('eventModal').addEventListener('click', (e) => {
            if (e.target.id === 'eventModal') {
                document.getElementById('eventModal').classList.remove('show');
            }
        });

        // Check if already logged in
        if (sessionStorage.getItem('pioneer_auth') === 'true') {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            loadGrowerData();
        }
    </script>
</body>
</html>
