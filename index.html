<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pioneer Analytics - Grower Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <h1>Pioneer Analytics</h1>
                <p>Grower Data Dashboard</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="access-code">Access Code</label>
                    <input type="password" id="access-code" placeholder="Enter access code" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Sign In</button>
                <p id="login-error" class="error-message"></p>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="dashboard-container hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>Pioneer Analytics</h1>
                <span class="subtitle">Grower Data Dashboard</span>
            </div>
            <div class="header-right">
                <span id="current-date"></span>
                <button id="logout-btn" class="btn btn-secondary">Logout</button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="overview">Overview</button>
            <button class="tab-btn" data-tab="historical">Historical Analysis</button>
            <button class="tab-btn" data-tab="forecasting">2027 Forecasting</button>
            <button class="tab-btn" data-tab="growers">Grower Analysis</button>
            <button class="tab-btn" data-tab="products">Product Mix</button>
            <button class="tab-btn" data-tab="data">Data Management</button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Overview Tab -->
            <section id="overview-tab" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Revenue</h3>
                        <p class="stat-value" id="total-revenue">$0</p>
                        <span class="stat-change positive" id="revenue-change">+0%</span>
                    </div>
                    <div class="stat-card">
                        <h3>Active Growers</h3>
                        <p class="stat-value" id="total-growers">0</p>
                        <span class="stat-change" id="growers-change">+0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Total Orders</h3>
                        <p class="stat-value" id="total-orders">0</p>
                        <span class="stat-change" id="orders-change">+0%</span>
                    </div>
                    <div class="stat-card">
                        <h3>Retention Rate</h3>
                        <p class="stat-value" id="retention-rate">0%</p>
                        <span class="stat-change" id="retention-change">+0%</span>
                    </div>
                </div>

                <div class="charts-row">
                    <div class="chart-container half">
                        <h3>Revenue Trend (2022-2026)</h3>
                        <canvas id="overview-revenue-chart"></canvas>
                    </div>
                    <div class="chart-container half">
                        <h3>Product Distribution</h3>
                        <canvas id="overview-product-chart"></canvas>
                    </div>
                </div>

                <div class="chart-container full">
                    <h3>Monthly Performance</h3>
                    <canvas id="overview-monthly-chart"></canvas>
                </div>
            </section>

            <!-- Historical Analysis Tab -->
            <section id="historical-tab" class="tab-content">
                <div class="filter-bar">
                    <div class="filter-group">
                        <label>Year Range</label>
                        <select id="hist-year-start">
                            <option value="2022">2022</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026" selected>2026</option>
                        </select>
                        <span>to</span>
                        <select id="hist-year-end">
                            <option value="2022">2022</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026" selected>2026</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Product</label>
                        <select id="hist-product">
                            <option value="all">All Products</option>
                            <option value="Corn Seed">Corn Seed</option>
                            <option value="Soybean Seed">Soybean Seed</option>
                            <option value="Sorghum">Sorghum</option>
                            <option value="Alfalfa">Alfalfa</option>
                            <option value="Herbicide">Herbicide</option>
                            <option value="Fungicide">Fungicide</option>
                            <option value="Insecticide">Insecticide</option>
                            <option value="Fertilizer">Fertilizer</option>
                            <option value="Equipment">Equipment</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <button id="apply-hist-filter" class="btn btn-primary">Apply Filter</button>
                </div>

                <div class="chart-container full">
                    <h3>5-Year Revenue Analysis</h3>
                    <canvas id="historical-revenue-chart"></canvas>
                </div>

                <div class="charts-row">
                    <div class="chart-container half">
                        <h3>Year-over-Year Comparison</h3>
                        <canvas id="yoy-comparison-chart"></canvas>
                    </div>
                    <div class="chart-container half">
                        <h3>Growth Rate by Year</h3>
                        <canvas id="growth-rate-chart"></canvas>
                    </div>
                </div>

                <div class="data-table-container">
                    <h3>Historical Summary</h3>
                    <table id="historical-summary-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Total Revenue</th>
                                <th>Orders</th>
                                <th>Growers</th>
                                <th>Avg Order Value</th>
                                <th>Growth</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- Forecasting Tab -->
            <section id="forecasting-tab" class="tab-content">
                <div class="forecast-header">
                    <h2>2027 Revenue Forecasting</h2>
                    <div class="forecast-controls">
                        <div class="filter-group">
                            <label>Forecast Method</label>
                            <select id="forecast-method">
                                <option value="linear">Linear Trend</option>
                                <option value="growth">Growth Rate</option>
                                <option value="weighted">Weighted Average</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Confidence Level</label>
                            <select id="confidence-level">
                                <option value="0.80">80%</option>
                                <option value="0.90" selected>90%</option>
                                <option value="0.95">95%</option>
                            </select>
                        </div>
                        <button id="run-forecast" class="btn btn-primary">Run Forecast</button>
                    </div>
                </div>

                <div class="forecast-summary">
                    <div class="forecast-card">
                        <h4>Projected Revenue</h4>
                        <p class="forecast-value" id="forecast-revenue">$0</p>
                        <span class="forecast-range" id="forecast-range">Range: $0 - $0</span>
                    </div>
                    <div class="forecast-card">
                        <h4>Expected Growers</h4>
                        <p class="forecast-value" id="forecast-growers">0</p>
                        <span class="forecast-range" id="forecast-growers-range">Range: 0 - 0</span>
                    </div>
                    <div class="forecast-card">
                        <h4>Projected Growth</h4>
                        <p class="forecast-value" id="forecast-growth">0%</p>
                        <span class="forecast-range" id="forecast-growth-range">vs 2026</span>
                    </div>
                </div>

                <div class="chart-container full">
                    <h3>Revenue Forecast with Confidence Intervals</h3>
                    <canvas id="forecast-chart"></canvas>
                </div>

                <div class="charts-row">
                    <div class="chart-container half">
                        <h3>Product Category Forecast</h3>
                        <canvas id="product-forecast-chart"></canvas>
                    </div>
                    <div class="chart-container half">
                        <h3>Monthly Forecast Distribution</h3>
                        <canvas id="monthly-forecast-chart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Grower Analysis Tab -->
            <section id="growers-tab" class="tab-content">
                <div class="filter-bar">
                    <div class="filter-group">
                        <label>Year</label>
                        <select id="grower-year">
                            <option value="2022">2022</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026" selected>2026</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Sort By</label>
                        <select id="grower-sort">
                            <option value="revenue">Revenue</option>
                            <option value="orders">Orders</option>
                            <option value="name">Name</option>
                        </select>
                    </div>
                    <input type="text" id="grower-search" placeholder="Search growers..." class="search-input">
                    <button id="apply-grower-filter" class="btn btn-primary">Apply</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>New Growers</h3>
                        <p class="stat-value" id="new-growers">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Returning Growers</h3>
                        <p class="stat-value" id="returning-growers">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Lost Growers</h3>
                        <p class="stat-value" id="lost-growers">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Retention Rate</h3>
                        <p class="stat-value" id="grower-retention">0%</p>
                    </div>
                </div>

                <div class="charts-row">
                    <div class="chart-container half">
                        <h3>Grower Retention Trend</h3>
                        <canvas id="retention-trend-chart"></canvas>
                    </div>
                    <div class="chart-container half">
                        <h3>Top 10 Growers by Revenue</h3>
                        <canvas id="top-growers-chart"></canvas>
                    </div>
                </div>

                <div class="data-table-container">
                    <h3>Grower Details</h3>
                    <table id="grower-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Grower Name</th>
                                <th>Total Revenue</th>
                                <th>Orders</th>
                                <th>Products</th>
                                <th>First Purchase</th>
                                <th>Last Purchase</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- Product Mix Tab -->
            <section id="products-tab" class="tab-content">
                <div class="filter-bar">
                    <div class="filter-group">
                        <label>Year</label>
                        <select id="product-year">
                            <option value="all">All Years</option>
                            <option value="2022">2022</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026" selected>2026</option>
                        </select>
                    </div>
                    <button id="apply-product-filter" class="btn btn-primary">Apply</button>
                </div>

                <div class="charts-row">
                    <div class="chart-container half">
                        <h3>Revenue by Product Category</h3>
                        <canvas id="product-revenue-chart"></canvas>
                    </div>
                    <div class="chart-container half">
                        <h3>Units Sold by Product</h3>
                        <canvas id="product-units-chart"></canvas>
                    </div>
                </div>

                <div class="chart-container full">
                    <h3>Product Performance Over Time</h3>
                    <canvas id="product-trend-chart"></canvas>
                </div>

                <div class="data-table-container">
                    <h3>Product Summary</h3>
                    <table id="product-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Revenue</th>
                                <th>Units Sold</th>
                                <th>Avg Price</th>
                                <th>% of Total</th>
                                <th>YoY Change</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- Data Management Tab -->
            <section id="data-tab" class="tab-content">
                <div class="data-management">
                    <!-- Pioneer Format Import -->
                    <div class="data-section pioneer-import">
                        <h3>Pioneer Sales Data Import</h3>
                        <p class="section-desc">Paste your Pioneer sales report data directly. Supports formats with columns: Year, Grower, Product, Hybrid, Quantity fields</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Data Year</label>
                                <select id="pioneer-year">
                                    <option value="auto">Auto-detect from data</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Product Type</label>
                                <select id="pioneer-product-type">
                                    <option value="auto">Auto-detect</option>
                                    <option value="Corn Seed">Corn Seed</option>
                                    <option value="Soybean Seed">Soybean Seed</option>
                                    <option value="Sorghum">Sorghum</option>
                                    <option value="Alfalfa">Alfalfa</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Price per Unit ($)</label>
                                <input type="number" id="pioneer-price" placeholder="280" value="280">
                            </div>
                        </div>
                        <textarea id="pioneer-paste" class="bulk-textarea" rows="10" placeholder="Paste your Pioneer sales data here...

Example format:
2024	Anderson	Corn	P0157AM	NR58	3	3	0	3
2024	Arrow Acres	Corn	P0339AM	NR62	5	5	0	5

The importer will automatically detect columns and extract grower names, products, and quantities."></textarea>
                        <div class="paste-actions">
                            <button id="parse-pioneer" class="btn btn-secondary">Preview Import</button>
                            <button id="import-pioneer" class="btn btn-primary" disabled>Import Data</button>
                            <span id="pioneer-status" class="import-status"></span>
                        </div>
                        <div id="pioneer-preview" class="preview-container hidden">
                            <h4>Import Preview</h4>
                            <div class="preview-stats">
                                <span><strong>Records:</strong> <span id="pioneer-record-count">0</span></span>
                                <span><strong>Growers:</strong> <span id="pioneer-grower-count">0</span></span>
                                <span><strong>Total Units:</strong> <span id="pioneer-unit-count">0</span></span>
                                <span><strong>Est. Value:</strong> <span id="pioneer-value-count">$0</span></span>
                            </div>
                            <table id="pioneer-preview-table" class="data-table"></table>
                        </div>
                    </div>

                    <!-- CSV Upload -->
                    <div class="data-section">
                        <h3>CSV Import</h3>
                        <p class="section-desc">Upload a CSV file with columns: date, invoice_number, grower_name, product, quantity, amount</p>
                        <div class="upload-area" id="csv-upload-area">
                            <input type="file" id="csv-file" accept=".csv" hidden>
                            <div class="upload-content">
                                <span class="upload-icon">üìÅ</span>
                                <p>Drag & drop CSV file here or <button class="btn-link" id="browse-csv">browse</button></p>
                            </div>
                        </div>
                        <div id="csv-preview" class="preview-container hidden">
                            <h4>Preview (first 5 rows)</h4>
                            <table id="csv-preview-table" class="data-table"></table>
                            <div class="preview-actions">
                                <button id="import-csv" class="btn btn-primary">Import Data</button>
                                <button id="cancel-csv" class="btn btn-secondary">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <!-- Manual Entry -->
                    <div class="data-section">
                        <h3>Manual Entry</h3>
                        <form id="manual-entry-form" class="entry-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" id="entry-date" required>
                                </div>
                                <div class="form-group">
                                    <label>Invoice Number</label>
                                    <input type="text" id="entry-invoice" placeholder="INV-001" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Grower Name</label>
                                    <input type="text" id="entry-grower" placeholder="John Smith" required>
                                </div>
                                <div class="form-group">
                                    <label>Product</label>
                                    <select id="entry-product" required>
                                        <option value="">Select Product</option>
                                        <option value="Corn Seed">Corn Seed</option>
                                        <option value="Soybean Seed">Soybean Seed</option>
                                        <option value="Sorghum">Sorghum</option>
                                        <option value="Alfalfa">Alfalfa</option>
                                        <option value="Herbicide">Herbicide</option>
                                        <option value="Fungicide">Fungicide</option>
                                        <option value="Insecticide">Insecticide</option>
                                        <option value="Fertilizer">Fertilizer</option>
                                        <option value="Equipment">Equipment</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Quantity</label>
                                    <input type="number" id="entry-quantity" placeholder="0" min="0" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>Amount ($)</label>
                                    <input type="number" id="entry-amount" placeholder="0.00" min="0" step="0.01" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Entry</button>
                        </form>
                    </div>

                    <!-- Bulk Paste -->
                    <div class="data-section">
                        <h3>Bulk Paste</h3>
                        <p class="section-desc">Paste tab-separated or comma-separated data (date, invoice_number, grower_name, product, quantity, amount)</p>
                        <textarea id="bulk-paste" class="bulk-textarea" placeholder="2024-01-15,INV-001,John Smith,Corn Seed,100,15000&#10;2024-01-16,INV-002,Jane Doe,Soybean Seed,50,7500"></textarea>
                        <div class="paste-actions">
                            <button id="parse-bulk" class="btn btn-secondary">Parse Data</button>
                            <button id="import-bulk" class="btn btn-primary" disabled>Import Data</button>
                        </div>
                        <div id="bulk-preview" class="preview-container hidden">
                            <h4>Parsed Data Preview</h4>
                            <table id="bulk-preview-table" class="data-table"></table>
                        </div>
                    </div>

                    <!-- Export Data -->
                    <div class="data-section">
                        <h3>Export Data</h3>
                        <div class="export-options">
                            <div class="filter-group">
                                <label>Year</label>
                                <select id="export-year">
                                    <option value="all">All Years</option>
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                </select>
                            </div>
                            <button id="export-csv" class="btn btn-primary">Export to CSV</button>
                            <button id="clear-data" class="btn btn-danger">Clear All Data</button>
                        </div>
                    </div>

                    <!-- Data Summary -->
                    <div class="data-section">
                        <h3>Current Data Summary</h3>
                        <div class="data-summary">
                            <p><strong>Total Records:</strong> <span id="total-records">0</span></p>
                            <p><strong>Date Range:</strong> <span id="data-date-range">No data</span></p>
                            <p><strong>Unique Growers:</strong> <span id="unique-growers">0</span></p>
                            <p><strong>Last Updated:</strong> <span id="last-updated">Never</span></p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2024-2027 Pioneer Analytics. All rights reserved.</p>
        </footer>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>
